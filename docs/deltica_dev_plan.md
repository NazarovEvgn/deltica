# План разработки Deltica

## Текущий статус: MVP полностью реализован ✅

### Реализованная функциональность

**Базовая функциональность:**
- ✅ Управление оборудованием (CRUD операции)
- ✅ Система верификации с автоматическим расчетом статусов
- ✅ Архивирование оборудования
- ✅ Управление файлами (загрузка, просмотр, скачивание)
- ✅ Поддержка кириллических имен файлов (RFC 5987)
- ✅ Закрепленные документы (PDF, доступные всем пользователям)

**Аутентификация и роли:**
- ✅ JWT-аутентификация (24-часовые токены)
- ✅ Управление пользователями через YAML конфигурацию
- ✅ Роли: Администратор (полный доступ) и Лаборант (только свой отдел, read-only)
- ✅ Страница авторизации с логотипом и формой входа по центру

**UI/UX:**
- ✅ RevoGrid таблицы с сортировкой, фильтрацией, авто-сохранением
- ✅ Naive UI компоненты с корпоративными цветами Газпром Нефти
- ✅ Шрифт PT Astra Sans (Regular, Bold, Italic)
- ✅ Логотип и фавикон
- ✅ Метрики дашборд (монохромный дизайн)
- ✅ Консолидированная админ-панель (dropdown меню)
- ✅ Текстовый вид информации для лаборантов (вместо disabled форм)
- ✅ Раздельные настройки колонок для админа и лаборанта

**Администрирование:**
- ✅ Backup базы данных (pg_dump, история резервных копий)
- ✅ Мониторинг системы (логи, CPU/память/диск, статус БД)
- ✅ Structured JSON logging с ротацией (30 дней)

**Тестирование:**
- ✅ 152 теста (все проходят успешно)
- ✅ Покрытие: file utils, API endpoints, security, encoding, status calculation

---

## Фаза тестирования (текущая)

**Цель:** Тестирование приложения по use cases, выявление и устранение багов

**Процесс:**
1. Тестирование основных сценариев использования
2. Проверка функциональности для разных ролей
3. Тестирование граничных случаев
4. Исправление выявленных проблем

---

## Следующие глобальные задачи

### 1. Desktop режим на Tauri

**Описание:** Упаковка приложения в desktop приложение с помощью Tauri

**Задачи:**
- [ ] Установка и настройка Tauri
- [ ] Конфигурация для Windows/Linux/macOS
- [ ] Настройка иконок и метаданных приложения
- [ ] Интеграция backend (запуск FastAPI сервера внутри Tauri или как отдельный процесс)
- [ ] Настройка автозапуска backend при старте приложения
- [ ] Создание инсталлятора для разных платформ
- [ ] Тестирование desktop версии

**Важные решения:**
- Backend может работать как отдельный процесс или встроенный в Tauri
- При изменениях backend/frontend потребуется пересборка приложения
- Рассмотреть вариант с портативной PostgreSQL БД для полностью автономной работы

### 2. Документация

**Пользовательская документация:**
- [ ] Руководство пользователя (для лаборантов)
  - Вход в систему
  - Просмотр оборудования своего отдела
  - Работа с таблицей (поиск, сортировка)
  - Просмотр файлов и закрепленных документов
- [ ] Руководство администратора
  - Управление пользователями через YAML
  - Добавление/редактирование/архивирование оборудования
  - Загрузка файлов и документов
  - Создание резервных копий
  - Работа с архивом
  - Мониторинг системы

**Техническая документация:**
- [ ] Инструкция по развертыванию на сервере
  - Системные требования
  - Установка зависимостей (Python, Node.js, PostgreSQL)
  - Настройка базы данных
  - Настройка переменных окружения (.env)
  - Миграции базы данных (Alembic)
  - Создание первых пользователей
  - Настройка systemd сервисов (для автозапуска)
  - Настройка nginx (reverse proxy)
- [ ] Инструкция по разработке
  - Структура проекта
  - Локальная разработка (start.ps1, start.bat)
  - Запуск тестов
  - Создание миграций
  - Добавление новых эндпоинтов
  - Работа с RevoGrid
- [ ] API документация (дополнение к Swagger UI)
  - Описание всех эндпоинтов
  - Примеры запросов/ответов
  - Описание схем данных
  - Обработка ошибок

**Операционная документация:**
- [ ] Процедуры резервного копирования и восстановления
- [ ] Процедуры обновления приложения
- [ ] Troubleshooting (типичные проблемы и решения)
- [ ] Процедуры масштабирования (если потребуется)

### 3. Docker контейнеризация

**Описание:** Упаковка приложения в Docker контейнеры для упрощенного деплоя

**Задачи:**
- [ ] Создать Dockerfile для backend (Python + FastAPI)
  - Multi-stage build для оптимизации размера
  - Использование uv для управления зависимостями
  - Настройка рабочего окружения
- [ ] Создать Dockerfile для frontend (Nginx + статика)
  - Build этап (npm run build)
  - Production этап (nginx для раздачи статики)
  - Настройка nginx.conf
- [ ] Создать docker-compose.yml
  - Сервис PostgreSQL
  - Сервис Backend (FastAPI)
  - Сервис Frontend (Nginx)
  - Volumes для персистентности данных (БД, файлы, логи, backup)
  - Networks для изоляции
  - Health checks
- [ ] Настроить переменные окружения
  - .env.example для Docker окружения
  - Secrets для продакшена
- [ ] Создать скрипты для управления
  - docker-deploy.sh (запуск)
  - docker-backup.sh (резервное копирование)
  - docker-restore.sh (восстановление)
  - docker-update.sh (обновление версии)
- [ ] Документация по Docker деплою
  - Инструкция по установке Docker
  - Запуск приложения через docker-compose
  - Настройка volumes и бэкапов
  - Обновление контейнеров

**Преимущества Docker:**
- Упрощенный деплой на любой сервер с Docker
- Изолированное окружение
- Легкое масштабирование
- Воспроизводимость окружения разработки/продакшена

---

## Дополнительные улучшения (опционально)

**Performance:**
- [ ] Кэширование на уровне backend (Redis)
- [ ] Оптимизация запросов к БД (индексы, eager loading)
- [ ] Пагинация для больших таблиц
- [ ] Lazy loading для файлов

**Безопасность:**
- [ ] HTTPS для продакшена
- [ ] Rate limiting для API
- [ ] Логирование попыток входа (для аудита)
- [ ] Шифрование чувствительных данных в БД

**Мониторинг:**
- [ ] Prometheus metrics
- [ ] Grafana дашборды
- [ ] Alerting при проблемах

**Интеграция:**
- [ ] Экспорт данных в Excel/CSV
- [ ] Импорт оборудования из Excel
- [ ] Email уведомления (истечение верификации)
- [ ] Интеграция с корпоративным AD/LDAP

---

## Архитектурные заметки

**Текущая архитектура:**
- Монолитное приложение (Backend + Frontend)
- Backend: FastAPI + SQLAlchemy + PostgreSQL
- Frontend: Vue 3 + Vite + Naive UI + RevoGrid
- Аутентификация: JWT tokens (localStorage)
- Файловое хранилище: локальная FS (backend/uploads/)

**Рекомендации для масштабирования:**
- Вынести файлы на объектное хранилище (S3/MinIO)
- Добавить очередь задач (Celery + Redis) для фоновых операций
- Разделить Backend API и Worker процессы
- Настроить CDN для статики Frontend
- Horizontal scaling через load balancer (если потребуется)

---

## История разработки

### Этап 1: Базовая функциональность
- Реализация CRUD для оборудования
- Система верификации
- Аутентификация и авторизация

### Этап 2: Файлы и документы
- Загрузка файлов с кириллицей
- Закрепленные документы
- Архивирование

### Этап 3: UI/UX улучшения
- Консолидация админ-панели
- Унификация стилей
- Метрики дашборд
- Улучшение RevoGrid (сортировка, фильтрация)

### Этап 4: Администрирование
- Backup базы данных
- Мониторинг системы и логирование
- Раздельные настройки для ролей

### Этап 5: Финальные доработки UX
- Текстовый вид для лаборантов
- Страница авторизации
- Черная кнопка входа
- Отладка и тестирование

---

**Последнее обновление:** 2025-10-18
